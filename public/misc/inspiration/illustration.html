<!doctype html>
<html class="no-js" lang="">

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<title>Illustration Inspiration | Simon Layfield | Designer</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="apple-touch-icon" href="apple-touch-icon.png">

	<link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">

	<style>
	h1 {
		font-family: 'Gloria Hallelujah', cursive;
		text-align: center;
		margin: 3rem auto;
	}
		img {
			max-width: 100%;
			opacity: 0;
			margin-bottom: 20px;
		}
		img.loaded {
			-webkit-animation: fade 5s;
		    animation: fade .1s;
			opacity: 1;
		}
		@-webkit-keyframes fade {
		    from {opacity: 0}
		    to {opacity: 1}
		} @keyframes fade {
		    from {opacity: 0}
		    to {opacity: 1}
		}
		.container {
			max-width: 1200px;
			margin: 0 auto;
			display: grid;
			grid-template-columns: 1fr;
			grid-gap: 20px;
		}
		@media (min-width: 600px) {
			.container {
				grid-template-columns: repeat(3, 1fr);
			}
			.column {
				max-width: 400px;
			}
		}
		.column {
			width: 100%;
			text-align: center;
		}
	</style>

</head>

<body>
	<!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
	<!--
        ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲
       ◀┌──────────────────────────────────────┐▶
       ◀│        WELCOME TO THE NETHER         │▶
       ◀└──────────────────────────────────────┘▶
        ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼


                    STAY A WHILE...
-->

	<div class="app"></div>

	<script id='template' type='text/ractive'>
		<h1>"So shines a good deed in a weary world."</h1>

		<div class="container tac">
			<div style="padding-bottom: 0px;" class="column">
				<div class="imagelist"></div>
			</div><!--
			--><div style="padding-bottom: 2px;" class="column">
				<div class="imagelist"></div>
			</div><!--
			--><div style="padding-bottom: 5px;" class="column">
				<div class="imagelist"></div>
			</div>
		</div>
	</script>


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/ractive"></script>

	<script>
		var shortestColumn = function(arr) {
			var lowest = 0;
			for (var i = 1; i < arr.length; i++) {
				if (arr[i] < arr[lowest]) lowest = i;
			}
			return lowest;
		};

		var ractive = Ractive({
			el: '.app',
			template: '#template',
			data: {
				imageList: null,
				scrollEnabled: true,
				imageIncrement: 9,
				n: 0
			},
			observe: {
				'imageList': {
					handler(value, old, path, idx) {
						ractive.fire('cycleImages');
					},
					init: false,
					strict: true
				}
			}
		});

		ractive.on('insertImage', function(args) {

			var imagelists = document.getElementsByClassName('imagelist');
			var columnHeights = [];

			[].forEach.call(imagelists, function(list, index) {
				columnHeights[index] = list.offsetHeight;
			});

			var column = shortestColumn(columnHeights);

			imagelists[column].appendChild(args.img);
			args.img.className = 'loaded';

			if (ractive.get('nextImage') == ractive.get('lastImage')) {
				ractive.set('scrollEnabled', true);
			}
		});

		ractive.on('loadImage', function(args) {

			if (ractive.get('nextImage').indexOf('.webm') > 0) {
				var video = document.createElement('video');
				video.autoplay = true;
				video.loop = true;
				video.controls = "controls";

				var source = document.createElement('source');
				source.src = 'https://storage.googleapis.com/simon-layfield-site/' + ractive.get('nextImage');
				source.type = "video/webm";
				video.appendChild(source);

				video.addEventListener('loadeddata', function() {
					ractive.fire('insertImage', {video});
				}, false);

			} else {

				var img = new Image();
				img.src = 'https://storage.googleapis.com/simon-layfield-site/' + ractive.get('nextImage');

				img.onload = function() {
					ractive.fire('insertImage', {img});
				}

			}

		});

		ractive.on('cycleImages', function() {

			var n = ractive.get('n');
			var imageIncrement = ractive.get('imageIncrement');

			if (n == ractive.get('imageList').length) {
				ractive.set('scrollEnabled', false);
				return;
			}

			if (n + imageIncrement > ractive.get('imageList').length) {
				ractive.set('limit', ractive.get('imageList').length);
			} else {
				ractive.set('limit', n + imageIncrement);
			}

			ractive.set('lastImage', ractive.get('imageList.' + (ractive.get('limit') - 1) + '.name'));

			for (var i = n; i < ractive.get('limit'); i++) {

				ractive.set('nextImage', ractive.get('imageList.' + i + '.name'));
				ractive.fire('loadImage');
			}

			ractive.set('n', n + imageIncrement);

		});

		var list = $.ajax({
			url: "https://www.googleapis.com/storage/v1/b/simon-layfield-site/o?prefix=auto/inspire",
			method: "GET",
			success: function(response) {
				ractive.set('imageList', response.items);
			}
		});


		window.onscroll = function(ev) {
			if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 100)) {
				if (ractive.get('scrollEnabled')) {
					ractive.fire('cycleImages');
				}
			}
		};
	</script>

	<script>
		(function(i, s, o, g, r, a, m) {
			i['GoogleAnalyticsObject'] = r;
			i[r] = i[r] || function() {
				(i[r].q = i[r].q || []).push(arguments)
			}, i[r].l = 1 * new Date();
			a = s.createElement(o),
				m = s.getElementsByTagName(o)[0];
			a.async = 1;
			a.src = g;
			m.parentNode.insertBefore(a, m)
		})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
		ga('create', 'UA-7071247-1', 'auto');
		ga('send', 'pageview');
	</script>
</body>

</html>
